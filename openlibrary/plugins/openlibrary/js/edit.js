export default function($) {
    function error(errordiv, input, message) {
        $(errordiv).show().html(message);
        $(input).focus();
        return false;
    }

    $('#excerpts').repeat({
        vars: {
            "prefix": 'work--excerpts',
        },
        validate: function(data) {
            if (!data.excerpt) {
                return error('#excerpts-errors', '#excerpts-excerpt', 'Please provide an excerpt.');
            }
            if (data.excerpt.length > 2000) {
                return error('#excerpts-errors', '#excerpts-excerpt', 'That excerpt is too long.')
            }
            $('#excerpts-errors').hide();
            return true;
        }
    });

    function update_len() {
        var len = $('#excerpts-excerpt').val().length;
        var color;
        if (len > 2000) {
            color = '#e44028';
        }
        else {
            color = 'gray';
        }
        $('#excerpts-excerpt-len').html(2000 - len).css('color', color);
    }

    function show_hide_title() {
        if ($('#excerpts-display .repeat-item').length > 1) {
            $('#excerpts-so-far').show();
        }
        else {
            $('#excerpts-so-far').hide();
        }
    }

    // update length on every keystroke
    $('#excerpts-excerpt').keyup(update_len);

    // update length on add.
    $('#excerpts')
        .bind('repeat-add', update_len)
        .bind('repeat-add', show_hide_title)
        .bind('repeat-remove', show_hide_title);

        // update length on load
    update_len();
    show_hide_title();
}
